<div class="client-list-container">
    <!-- Stats Cards -->
    <div class="stats-grid">
        <mat-card class="stat-card stat-card-blue">
            <mat-card-content>
                <div class="stat-value">{{ stats.totalClients }}</div>
                <div class="stat-label">Clients actifs</div>
            </mat-card-content>
        </mat-card>
        <mat-card class="stat-card stat-card-indigo">
            <mat-card-content>
                <div class="stat-value">{{ stats.clientsCompte }}</div>
                <div class="stat-label">Clients en compte</div>
            </mat-card-content>
        </mat-card>
        <mat-card class="stat-card stat-card-teal">
            <mat-card-content>
                <div class="stat-value">{{ stats.clientsPassage }}</div>
                <div class="stat-label">Clients de passage</div>
            </mat-card-content>
        </mat-card>
        <mat-card class="stat-card stat-card-orange">
            <mat-card-content>
                <div class="stat-value">{{ stats.clientsAccess }}</div>
                <div class="stat-label">Clients inactifs</div>
            </mat-card-content>
        </mat-card>
    </div>

    <!-- Actions Bar -->
    <div class="actions-bar">
        <h2 class="section-title">Vue d'ensemble</h2>
        <div class="actions">
            <button mat-stroked-button class="action-btn" (click)="exportXLS()">
                <mat-icon>file_download</mat-icon> Exporter
            </button>
            <button mat-raised-button color="primary" class="action-btn" routerLink="/clients/new">
                <mat-icon>add</mat-icon> Ajouter un client
            </button>
        </div>
    </div>

    <!-- Filters -->
    <mat-card class="filter-card">
        <mat-card-content class="filter-content">
            <div class="filter-row">
                <div class="filter-field">
                    <label class="filter-label">Type de client</label>
                    <mat-form-field subscriptSizing="dynamic" class="w-full no-label-field">
                        <mat-select [(ngModel)]="filter.type" (selectionChange)="applyFilter()">
                            <mat-option value="">Tous</mat-option>
                            <mat-option value="particulier">Particulier</mat-option>
                            <mat-option value="professionnel">Professionnel</mat-option>
                            <mat-option value="anonyme">Anonyme</mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>

                <div class="filter-field">
                    <label class="filter-label">Statut</label>
                    <mat-form-field subscriptSizing="dynamic" class="w-full no-label-field">
                        <mat-select [(ngModel)]="filter.status" (selectionChange)="applyFilter()">
                            <mat-option value="">Tous</mat-option>
                            <mat-option value="actif">Actif</mat-option>
                            <mat-option value="inactif">Inactif</mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>

                <div class="filter-field">
                    <label class="filter-label">Nom</label>
                    <mat-form-field subscriptSizing="dynamic" class="w-full no-label-field">
                        <input matInput [(ngModel)]="filter.search" (keyup.enter)="applyFilter()"
                            placeholder="Rechercher...">
                    </mat-form-field>
                </div>

                <div class="filter-field">
                    <label class="filter-label">Prénom</label>
                    <mat-form-field subscriptSizing="dynamic" class="w-full no-label-field">
                        <input matInput [(ngModel)]="filter.prenom" (keyup.enter)="applyFilter()"
                            placeholder="Prénom...">
                    </mat-form-field>
                </div>
            </div>

            <div class="filter-row">
                <div class="filter-field">
                    <label class="filter-label">Téléphone</label>
                    <mat-form-field subscriptSizing="dynamic" class="w-full no-label-field">
                        <input matInput [(ngModel)]="filter.telephone" (keyup.enter)="applyFilter()"
                            placeholder="Téléphone...">
                    </mat-form-field>
                </div>

                <div class="filter-field">
                    <label class="filter-label">CIN</label>
                    <mat-form-field subscriptSizing="dynamic" class="w-full no-label-field">
                        <input matInput [(ngModel)]="filter.cin" (keyup.enter)="applyFilter()" placeholder="CIN...">
                    </mat-form-field>
                </div>

                <div class="filter-field">
                    <label class="filter-label">Ville</label>
                    <mat-form-field subscriptSizing="dynamic" class="w-full no-label-field">
                        <input matInput [(ngModel)]="filter.ville" (keyup.enter)="applyFilter()" placeholder="Ville...">
                    </mat-form-field>
                </div>

                <div class="filter-field filter-button-field">
                    <label class="filter-label">&nbsp;</label>
                    <button mat-raised-button color="primary" (click)="applyFilter()" class="w-full filter-search-btn">
                        <mat-icon>search</mat-icon> Rechercher
                    </button>
                </div>
            </div>
        </mat-card-content>
    </mat-card>

    <!-- Table -->
    <div class="table-container">
        <table mat-table [dataSource]="dataSource" matSort class="clients-table">

            <!-- Type Column -->
            <ng-container matColumnDef="type">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Type </th>
                <td mat-cell *matCellDef="let row"> {{row.type | titlecase}} </td>
            </ng-container>

            <!-- Name Column -->
            <ng-container matColumnDef="nom">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Nom </th>
                <td mat-cell *matCellDef="let row"> {{getClientName(row)}} </td>
            </ng-container>

            <!-- Prénom Column -->
            <ng-container matColumnDef="prenom">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Prénom </th>
                <td mat-cell *matCellDef="let row"> {{getClientPrenom(row)}} </td>
            </ng-container>

            <!-- Téléphone Column -->
            <ng-container matColumnDef="telephone">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Téléphone </th>
                <td mat-cell *matCellDef="let row"> {{row.telephone || '--'}} </td>
            </ng-container>

            <!-- CIN Column -->
            <ng-container matColumnDef="cin">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> CIN </th>
                <td mat-cell *matCellDef="let row"> {{getClientCIN(row)}} </td>
            </ng-container>

            <!-- City Column -->
            <ng-container matColumnDef="ville">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Ville </th>
                <td mat-cell *matCellDef="let row"> {{getClientCity(row)}} </td>
            </ng-container>

            <!-- Status Column -->
            <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Statut </th>
                <td mat-cell *matCellDef="let row">
                    <span class="status-badge"
                        [ngClass]="{'status-active': row.status === 'actif', 'status-inactive': row.status === 'inactif'}">
                        {{row.status | titlecase}}
                    </span>
                </td>
            </ng-container>

            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef> Actions </th>
                <td mat-cell *matCellDef="let row">
                    <button mat-icon-button color="primary" [routerLink]="['/clients', row.id]">
                        <mat-icon>visibility</mat-icon>
                    </button>
                    <button mat-icon-button color="accent" [routerLink]="['/clients', row.id, 'edit']">
                        <mat-icon>edit</mat-icon>
                    </button>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

            <!-- Row shown when there is no matching data. -->
            <tr class="mat-row" *matNoDataRow>
                <td class="mat-cell" colspan="8">Aucune donnée correspondant aux filtres</td>
            </tr>
        </table>

        <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" aria-label="Select page of users"></mat-paginator>
    </div>
</div>