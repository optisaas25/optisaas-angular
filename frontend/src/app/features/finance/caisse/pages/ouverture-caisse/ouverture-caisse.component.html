<div class="ouverture-caisse-container">
    <mat-card class="form-card">
        <mat-card-header>
            <mat-card-title>Ouvrir une Caisse</mat-card-title>
            <mat-card-subtitle>Initialisation de la journée de caisse</mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
            <form [formGroup]="form" (ngSubmit)="onSubmit()">
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Sélectionner la caisse</mat-label>
                    <mat-select formControlName="caisseId">
                        <mat-option *ngFor="let caisse of caisses" [value]="caisse.id"
                            [disabled]="caisse.journees && caisse.journees[0]?.statut === 'OUVERTE'">
                            {{ caisse.nom }}
                            <span *ngIf="caisse.journees && caisse.journees[0]?.statut === 'OUVERTE'"
                                class="status-warn">
                                (Déjà ouverte)
                            </span>
                        </mat-option>
                    </mat-select>
                    <mat-error *ngIf="form.get('caisseId')?.hasError('required')">
                        La caisse est obligatoire
                    </mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Fond de caisse initial (DH)</mat-label>
                    <input matInput type="number" formControlName="fondInitial" min="0">
                    <mat-error *ngIf="form.get('fondInitial')?.hasError('required')">
                        Le fond initial est obligatoire
                    </mat-error>
                    <mat-error *ngIf="form.get('fondInitial')?.hasError('min')">
                        Le montant doit être positif
                    </mat-error>
                </mat-form-field>

                <div class="info-section">
                    <p><strong>Caissier :</strong> {{ currentUser }}</p>
                    <p><strong>Date :</strong> {{ currentDate | date:'short' }}</p>
                    <!-- Using 0 as date placeholder, will check if 'now' pipe exists or use TS date -->
                </div>

                <div class="actions">
                    <button mat-button type="button" (click)="cancel()">Annuler</button>
                    <button mat-raised-button color="primary" type="submit" [disabled]="form.invalid || loading">
                        {{ loading ? 'Ouverture...' : 'Ouvrir la Caisse' }}
                    </button>
                </div>
            </form>
        </mat-card-content>
    </mat-card>
</div>