<div class="dialog-header">
    <h2 mat-dialog-title>Historique des Mouvements - {{ data.product.designation }}</h2>
    <div class="header-actions">
        <button mat-icon-button (click)="loadHistory()" matTooltip="Actualiser">
            <mat-icon>refresh</mat-icon>
        </button>
        <button mat-icon-button (click)="close()" matTooltip="Fermer">
            <mat-icon>close</mat-icon>
        </button>
    </div>
</div>

<mat-dialog-content class="dialog-content">
    <div class="loading-container" *ngIf="loading">
        <mat-spinner diameter="40"></mat-spinner>
    </div>

    <div class="no-data" *ngIf="!loading && movements.length === 0">
        <mat-icon>history_toggle_off</mat-icon>
        <p>Aucun mouvement enregistré pour ce produit.</p>
    </div>

    <table mat-table [dataSource]="movements" *ngIf="!loading && movements.length > 0">

        <!-- Date Column -->
        <ng-container matColumnDef="dateMovement">
            <th mat-header-cell *matHeaderCellDef> Date </th>
            <td mat-cell *matCellDef="let element"> {{element.dateMovement | date:'dd/MM/yyyy HH:mm'}} </td>
        </ng-container>

        <!-- Type Column -->
        <ng-container matColumnDef="type">
            <th mat-header-cell *matHeaderCellDef> Type </th>
            <td mat-cell *matCellDef="let element">
                <span [class.movement-in]="isPositive(element.type)"
                    [class.movement-out]="!isPositive(element.type) && element.type !== 'TRANSFERT'"
                    [class.movement-transfer]="element.type === 'TRANSFERT'">
                    {{getTypeLabel(element.type)}}
                </span>
            </td>
        </ng-container>

        <!-- Quantity Column -->
        <ng-container matColumnDef="quantite">
            <th mat-header-cell *matHeaderCellDef> Quantité </th>
            <td mat-cell *matCellDef="let element"> {{element.quantite}} </td>
        </ng-container>

        <!-- Purchase Price Column -->
        <ng-container matColumnDef="prixAchat">
            <th mat-header-cell *matHeaderCellDef> Prix d'achat </th>
            <td mat-cell *matCellDef="let element"> {{formatPrice(element.prixAchatUnitaire)}} </td>
        </ng-container>

        <!-- Sale Price Column -->
        <ng-container matColumnDef="prixVente">
            <th mat-header-cell *matHeaderCellDef> Prix de vente </th>
            <td mat-cell *matCellDef="let element"> {{formatPrice(element.prixVenteUnitaire)}} </td>
        </ng-container>

        <!-- Fiche Number Column -->
        <ng-container matColumnDef="ficheNumero">
            <th mat-header-cell *matHeaderCellDef> N° Fiche </th>
            <td mat-cell *matCellDef="let element"> {{getFicheNumero(element)}} </td>
        </ng-container>

        <!-- Client Name Column -->
        <ng-container matColumnDef="clientNom">
            <th mat-header-cell *matHeaderCellDef> Client </th>
            <td mat-cell *matCellDef="let element"> {{getClientName(element)}} </td>
        </ng-container>

        <!-- Motif Column -->
        <ng-container matColumnDef="motif">
            <th mat-header-cell *matHeaderCellDef> Motif </th>
            <td mat-cell *matCellDef="let element"> {{element.motif}} </td>
        </ng-container>

        <!-- User Column -->
        <ng-container matColumnDef="utilisateur">
            <th mat-header-cell *matHeaderCellDef> Utilisateur </th>
            <td mat-cell *matCellDef="let element"> {{element.utilisateur}} </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
</mat-dialog-content>

<div class="dialog-actions">
    <button mat-button (click)="close()">Fermer</button>
</div>